"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6791],{45416:function(e,n,t){t.d(n,{Z:function(){return P},$:function(){return _}});var r=t(10866),a=t(95235),c=t(2784),i=t(27959),o=t(40567),u=t(91106),l=t(85223),s=t(72456),d=t(72004),f=t(205),k=t(71697);function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function h(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach(function(n){(0,a.Z)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var b=function(e){var n=(0,f.TQ)(),t=n.token,r=n.bankDelay,a=n.setBankDelay,p=n.setReAuthToken,b=n.setIsPlaidAuthError,v=(0,l.ZP)(),x=v.user,P=v.updateUser,g=(0,u.Z)().showGenericErrorToast,m=(0,c.useState)([]),A=m[0],y=m[1],j=(0,l.Am)(x).step!==i.OnboardingStep.Onboarded,T=(0,k.Db)(i.updateUser,{mutationId:i.updateUserId,onSuccess:function(e){P({hasOnboarded:!0,user:h(h({},x),e)})}}),O=(e||{}).refetchBankAccounts,S=function(e,n){var t=n.accounts.map(function(e){return e.id});return y(t),i.PlaidService.getPlaidAccessTokenPlaidItemPublicTokenExchangeGet(e).then(function(){return i.BankingService.createBankTransferMethodsUserBankTransferMethodPost(t)},function(e){g("An error occurred while linking your bank account. Please try again later."),(0,s.j)("backstage_add_bank_account_error",{error:e})})},w=function(){a(!0);var e=(0,l.n7)({step:i.OnboardingStep.BankingLink,userData:x});T.mutate(h(h({email:x.email},x),{},{account_metadata:h({},x.account_metadata),onboarding:e}))},E=(0,c.useCallback)(function(e,n){S(e,n).then(function(e){var n;if(null!=e&&null!==(n=e.detail)&&void 0!==n&&null!==(n=n.ctx)&&void 0!==n&&n.link_token){p(e.detail.ctx.link_token);return}b(!1),p(null),j&&w(),O&&O(),(0,d.np)("linkACHAccount").then()})},[]),Z=(0,c.useCallback)(function(e){e&&(g("An error occurred while linking your bank account. Please try again later."),(0,s.j)("plaid_link_error",{error:e}))},[]),B=(0,o.usePlaidLink)({onExit:Z,onSuccess:E,token:t}),C=B.open,N=B.ready;return _({onSuccess:function(e){i.PlaidService.getPlaidAccessTokenPlaidItemPublicTokenExchangeGet(e).then(function(){return i.BankingService.createBankTransferMethodsUserBankTransferMethodPost(A)},function(e){g("An error occurred while linking your bank account. Please try again later."),(0,s.j)("backstage_add_bank_account_error",{error:e})}).then(function(e){var n;if(null!=e&&null!==(n=e.detail)&&void 0!==n&&null!==(n=n.ctx)&&void 0!==n&&n.link_token){b(!0),p(e.detail.ctx.link_token);return}b(!1),p(null),j&&w(),O&&O(),(0,d.np)("linkACHAccount").then()})}}),{bankDelay:r,open:C,ready:N}},v=t(60543),x=t(52322),P=function(e){var n=e.refetchBankAccounts,t=(0,v.Z)(["package_banking"]),a=b({refetchBankAccounts:n}),c=a.open;return a.ready?(0,x.jsx)(r.xC,{borderStyle:"dashed",iconName:"circlePlus",onClick:function(){return c()},position:"center",size:"l",title:t("link_button.label")}):(0,x.jsx)("div",{className:"flex p-5 items-center justify-center",children:(0,x.jsx)(r.$j,{size:"xl"})})},g=t(36335),m=t(34063),A={default:"flex mt-4 w-full",true:"hidden",false:""},y={id:g.e.PlaidAuth,position:"start",title:"Re-auth",isCloseable:!0},j=function(e){var n=e.receivedToken,t=e.onSuccess,a=(0,c.useState)(!0),i=a[0],u=a[1],l=(0,f.TQ)().isPlaidAuthError,s=(0,v.Z)(["package_banking"]);return(0,x.jsxs)("div",{className:"\nflex\nflex-col\ngrow\nitems-center\nw-full\npx-[15px]\nmd:px-5\n",children:[(0,x.jsx)("div",{className:"flex",children:s("plaid_auth.message")}),i&&(0,x.jsx)("div",{className:"flex justify-center items-center",children:(0,x.jsx)(r.$j,{size:"xl"})}),(0,x.jsx)("div",{className:(0,m.kO)(i,A),children:(0,x.jsx)(o.PlaidLink,{className:"!p-0 !outline-none !rounded-none !border-0 w-full",onSuccess:t,onLoad:function(){return u(!1)},token:n,children:(0,x.jsx)("div",{className:"\nfont-mori\nfont-semibold\nbg-blue\ntext-white\nhover:darken-20\ntext-[14px]\nleading-5\npy-2.5\npx-4\n",children:(0,x.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,x.jsx)(r.JO,{color:"white",name:"repeat"}),s("plaid_auth.button_label")]})})})}),l&&(0,x.jsx)("div",{className:"flex mt-4",children:s("plaid_auth.auth_error")})]})},_=function(e){var n=e.onSuccess,t=(0,g.Z)(),r=t.showModal,a=t.closeModal,i=(0,f.TQ)(),o=i.reAuthToken,u=i.setReAuthToken,l=function(e){u(null),a(g.e.PlaidAuth),n(e)};(0,c.useEffect)(function(){null!==o&&r((0,x.jsx)(j,{onSuccess:l,receivedToken:o}),y)},[o])}},205:function(e,n,t){t.d(n,{_3:function(){return E},ZP:function(){return Z},ro:function(){return w},TQ:function(){return _}});var r,a=t(20406),c=t(8529),i=t(82841),o=t.n(i),u=t(27959),l=t(91106),s=t(2784),d=t(65058),f=t(752),k=t(45416),p=t(85223),h=t(72456),b=t(87476),v=t.n(b),x=!1,P=null,g=(r=(0,a.Z)(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x||null!==P)){e.next=2;break}return e.abrupt("return");case 2:return x=!0,e.prev=3,e.next=6,u.PlaidService.getPlaidLinkTokenPlaidLinkTokenCreateGet();case 6:P=e.sent.link_token,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),(0,h.j)("plaid-link-token-initial-get-error",{error:e.t0});case 14:x=!1;case 15:case"end":return e.stop()}},e,null,[[3,11]])})),function(){return r.apply(this,arguments)}),m=(0,d.cn)(null),A=(0,d.cn)(null),y=(0,d.cn)(!1),j=(0,d.cn)(!1),_=function(){var e=(0,f.KO)(A),n=(0,c.Z)(e,2),t=n[0],r=n[1],a=(0,f.KO)(m),i=(0,c.Z)(a,2),o=i[0],u=i[1],l=(0,f.KO)(y),d=(0,c.Z)(l,2),k=d[0],h=d[1],b=(0,f.KO)(j),x=(0,c.Z)(b,2),_=x[0],T=x[1],O=(0,p.ZP)(),S=O.initialized,w=O.authenticated,E=v()({checkForExisting:!0,src:"https://cdn.plaid.com/link/v2/stable/link-initialize.js"}),Z=(0,c.Z)(E,1)[0];return(0,s.useEffect)(function(){w&&S&&(Z||_||g().then(function(){return r(P)}))},[Z,_,S,w]),{bankDelay:k,isPlaidAuthError:_,reAuthToken:o,setBankDelay:h,setIsPlaidAuthError:T,setReAuthToken:function(e){o&&null!==e||u(e)},setToken:r,token:t}},T=(0,d.cn)([]),O=(0,d.cn)(!1),S=(0,d.cn)(!1),w=function(e){var n,t;return" ".concat((n=e.subtype).charAt(0).toUpperCase()+n.slice(1)," ••••\n        ").concat((t=e.numbers.account).split("").splice(t.length-4).join(""),"\n        ")},E=function(e,n){return e.map(function(e){var n;return null===(n=e.numbers)||void 0===n?void 0:n.account_id}).includes(n)?w(e.filter(function(e){return e.numbers.account_id===n})[0]):n||"EMPTY STRING"},Z=function(){var e,n=(0,f.KO)(T),t=(0,c.Z)(n,2),r=t[0],i=t[1],d=(0,f.KO)(O),h=(0,c.Z)(d,2),b=h[0],v=h[1],x=(0,f.KO)(S),P=(0,c.Z)(x,2),g=P[0],m=P[1],A=_(),y=A.setReAuthToken,j=A.setIsPlaidAuthError,w=A.isPlaidAuthError,E=(0,l.Z)().showApiErrorToast,Z=(0,p.ZP)().user,B=(e=(0,a.Z)(o().mark(function e(){var n,t,r;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!w){e.next=2;break}return e.abrupt("return");case 2:if(!((n=(0,p.Am)(Z)).step!==u.OnboardingStep.BankingLink&&n.step!==u.OnboardingStep.Onboarded)){e.next=5;break}return e.abrupt("return");case 5:return m(!0),e.prev=6,e.next=9,u.PlaidService.getPlaidAuthAccountByTransferTypePlaidAccountsGet(u.TransferTypeEnum.ACH);case 9:null!=(r=e.sent)&&null!==(t=r.detail)&&void 0!==t&&null!==(t=t.ctx)&&void 0!==t&&t.link_token?y(r.detail.ctx.link_token):(y(null),i(r.accounts)),m(!1),v(!0),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(6),E(e.t0,u.getPlaidAccountsId),m(!1),j(!0);case 20:case"end":return e.stop()}},e,null,[[6,15]])})),function(){return e.apply(this,arguments)});return(0,s.useEffect)(function(){!g&&(b||B().then())},[b,g]),(0,k.$)({onSuccess:function(){m(!0),u.PlaidService.getPlaidAuthAccountByTransferTypePlaidAccountsGet(u.TransferTypeEnum.ACH).then(function(e){var n;null!=e&&null!==(n=e.detail)&&void 0!==n&&null!==(n=n.ctx)&&void 0!==n&&n.link_token?(j(!0),y(e.detail.ctx.link_token)):(j(!1),y(null),i(e.accounts)),m(!1),v(!0)}).catch(function(e){E(e,u.getPlaidAccountsId),m(!1)})}}),{bankAccounts:r,getAccounts:B,isLoading:g}}}}]);